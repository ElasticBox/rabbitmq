[{rabbit,
    [{auth_backends,[rabbit_auth_backend_internal]},
     {auth_mechanisms,['PLAIN','AMQPLAIN']},
     {backing_queue_module,rabbit_variable_queue},
     {cluster_nodes,[]},
     {collect_statistics,fine},
     {collect_statistics_interval,5000},
     {default_permissions,[<<".*">>,<<".*">>,<<".*">>]},
     {default_user,<<"<%= @user_name %>">>},
     {default_pass,<<"<%= @password %>">>},
     {default_user_tags,[administrator]},
     {default_vhost,<<"/">>},
     {delegate_count,16},
     {heartbeat,120},
     {frame_max,131072},
     {hipe_compile,false},
     {disk_free_limit,500000000},
     {msg_store_file_size_limit,16777216},
     {msg_store_index_module,rabbit_msg_store_ets_index},
     {queue_index_max_journal_entries,262144},
     {server_properties,[]},
     <% if !(@ca_cert_file.nil? || @ca_cert_file.empty?) %>
     {ssl_listeners, [<%= @ssl_port %>]},
     {ssl_options, 
         [{cacertfile,"/etc/rabbitmq/ssl/<%= @ca_cert_file %>"},
             {certfile,"/etc/rabbitmq/ssl/<%= @cert_file %>"},
             {keyfile,"/etc/rabbitmq/ssl/<%= @key_file %>"},
             {verify,verify_none},
             {fail_if_no_peer_cert,false}]},
     <% else %>
     {ssl_listeners, []},
     {ssl_options, []},
     <% end %>
     {tcp_listen_options,
         [binary,
             {packet,raw},
             {reuseaddr,true},
             {backlog,128},
             {nodelay,true},
             {exit_on_close,false},
             {keepalive,true}
         ]},
      {tcp_listeners,[<%= @port %>]},
      {trace_vhosts,[<<"/">>]},
	  {vm_memory_high_watermark,0.4}
    ]
}].
